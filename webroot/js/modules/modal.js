/**
 * @project       tusk
 * @author        carsten.coull@swu.de
 * @build         Wed, Jan 10, 2024 4:53 PM ET
 * @release       f39df71e611dee1cda1bc6540ca6aa0707b9a278 [page-tree]
 * @copyright     Copyright (c) 2024, SWU Stadtwerke Ulm / Neu-Ulm GmbH
 *
 */
export default class Modal{constructor(t){this.main=t,this.main.debug,this.Conf={isOpenClass:"modal-is-open",openingClass:"modal-is-opening",closingClass:"modal-is-closing",animationDuration:400},this.visibleModal=null,this.buttons=document.querySelectorAll("[data-target]"),this.buttons.length>0&&this.init()}init(){this.buttons.forEach((t=>{let e=document.getElementById(t.dataset.target);this.initButton(t,e)}))}initButton(t,e){if(null==e){let e=this.newModal(t);this.addContent(e,t.dataset.modal),this.addQuery(e),e.addEventListener("confirm",(()=>{let t=e.querySelector("form");t&&t.submit()}))}else if("DIALOG"==e.tagName)t.addEventListener("click",(n=>{if("Close"==t.ariaLabel){let t=new Event("cancel");e.dispatchEvent(t)}this.toggleModal(n,e)}));else if("FORM"==e.tagName){let n=this.newModal(t);this.addContent(n,t.dataset.modal),this.addQuery(n),n.addEventListener("confirm",(()=>{e.submit()}))}}toggleModal(t,e){t.preventDefault(),this.isModalOpen(e)?this.closeModal(e):this.openModal(e)}isModalOpen(t){return!(!t.hasAttribute("open")||"false"==t.getAttribute("open"))}openModal(t){this.visibleModal=t;let e=new CustomEvent("open",{detail:this.button});t.dispatchEvent(e),t.showModal()}closeModal(t){this.visibleModal=null,t.close()}newModal(t,e=!0){let n=t.dataset.target;null==n&&(n=t.name,t.dataset.target=n);let a=document.createElement("dialog"),i=document.createElement("article"),l=document.createElement("main"),o=document.createElement("button");return a.id=n,o.classList.add("close","button","outline","contrast"),o.ariaLabel="Close",o.dataset.target=n,i.appendChild(o),i.appendChild(l),a.appendChild(i),document.body.appendChild(a),this.initButton(o,a),e&&this.initButton(t,a),a}addContent(t,e){t.querySelector("main").innerHTML=e}addQuery(t,e={cancel:!0,confirm:!0}){let n=t.querySelector("article"),a=document.createElement("footer");if(e.cancel){let e=document.createElement("button");e.innerText="cancel",e.classList.add("contrast"),a.appendChild(e),e.addEventListener("click",(()=>{let e=new Event("cancel");t.dispatchEvent(e),this.closeModal(t)}))}if(e.confirm){let e=document.createElement("button");e.innerText="confirm",a.appendChild(e),e.addEventListener("click",(()=>{let e=new Event("confirm");t.dispatchEvent(e),this.closeModal(t)}))}n.appendChild(a)}reset(t){this.addContent(t,"")}}