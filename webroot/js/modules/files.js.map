{"version":3,"names":[],"mappings":"","sources":["files.js"],"sourcesContent":["export default class Files {\n\tconstructor(main) {\n\t\tthis.main = main;\n\t\tthis.Modal = main.Modal;\n\n\t\tif (this.main.debug) {\n\t\t\tconsole.debug(\"Files::const\");\n\t\t}\n\n\t\tthis.buttons = document.querySelectorAll('[type=directory]');\n\t\tif (this.buttons.length > 0) {\n\t\t\tthis.init();\n\t\t}\n\t}\n\n\tinit() {\n\t\tthis.buttons.forEach(button => {\n\t\t\tlet modal = this.Modal.newModal(button, false);\n\t\t\tthis.Modal.addQuery(modal);\n\n\t\t\tlet input = document.getElementById(button.name);\n\t\t\tlet fileInput = document.querySelector('input[name=' + button.name + '_file]');\n\n\t\t\tif (fileInput) {\n\t\t\t\tfileInput.addEventListener('change', (event) => {\n\t\t\t\t\tlet files = fileInput.files;\n\t\t\t\t\tlet output = [];\n\t\t\t\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\t\t\t\tvar filename = files[i].name.replace(/^.*[\\\\/]/, '');\n\t\t\t\t\t\toutput.push(filename);\n\t\t\t\t\t}\n\t\t\t\t\tinput.value = output.join(', ');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmodal.addEventListener('confirm', (e) => {\n\t\t\t\tlet selected = modal.querySelector('input[type=radio]:checked');\n\t\t\t\tinput.value = selected.value;\n\t\t\t});\n\n\t\t\tmodal.addEventListener('close', (e) => {\n\t\t\t\tthis.Modal.reset(modal);\n\t\t\t});\n\n\t\t\tbutton.addEventListener('click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tlet url = button.value + '?';\n\t\t\t\turl += new URLSearchParams({\n\t\t\t\t\tmodal: true,\n\t\t\t\t\tdir: button.dataset.dir,\n\t\t\t\t\ttypes: button.dataset.types\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tfetch(url, {\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'X-Requested-With': 'XMLHttpRequest'\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\treturn response.text();\n\t\t\t\t\t})\n\t\t\t\t\t.then((html) => {\n\t\t\t\t\t\tthis.Modal.addContent(modal, html);\n\t\t\t\t\t\tthis.Modal.openModal(modal);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(err => console.log(err))\n\t\t\t})\n\t\t});\n\t}\n}"],"file":"files.js"}